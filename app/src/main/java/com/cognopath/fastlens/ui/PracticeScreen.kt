package com.cognopath.fastlens.ui\n\nimport androidx.compose.foundation.layout.Arrangement\nimport androidx.compose.foundation.layout.Column\nimport androidx.compose.foundation.layout.Row\nimport androidx.compose.foundation.layout.Spacer\nimport androidx.compose.foundation.layout.fillMaxSize\nimport androidx.compose.foundation.layout.fillMaxWidth\nimport androidx.compose.foundation.layout.height\nimport androidx.compose.foundation.layout.padding\nimport androidx.compose.foundation.layout.width\nimport androidx.compose.material3.Button\nimport androidx.compose.material3.Card\nimport androidx.compose.material3.CardDefaults\nimport androidx.compose.material3.CenterAlignedTopAppBar\nimport androidx.compose.material3.ExperimentalMaterial3Api\nimport androidx.compose.material3.MaterialTheme\nimport androidx.compose.material3.Scaffold\nimport androidx.compose.material3.Text\nimport androidx.compose.material3.TopAppBarDefaults\nimport androidx.compose.runtime.Composable\nimport androidx.compose.runtime.collectAsState\nimport androidx.compose.runtime.getValue\nimport androidx.compose.ui.Alignment\nimport androidx.compose.ui.Modifier\nimport androidx.compose.ui.graphics.Color\nimport androidx.compose.ui.text.font.FontWeight\nimport androidx.compose.ui.unit.dp\nimport androidx.lifecycle.viewmodel.compose.viewModel\nimport com.cognopath.fastlens.presentation.PracticeViewModel\nimport com.cognopath.fastlens.ui.components.FastLensCard\nimport com.cognopath.fastlens.ui.components.QuestionCard\nimport java.util.concurrent.TimeUnit\n\n@OptIn(ExperimentalMaterial3Api::class)\n@Composable\nfun PracticeScreen(viewModel: PracticeViewModel = viewModel()) {\n    val uiState by viewModel.uiState.collectAsState()\n\n    Scaffold(\n        topBar = {\n            CenterAlignedTopAppBar(\n                title = { Text(\"Speed Arithmetic\") },\n                colors = TopAppBarDefaults.centerAlignedTopAppBarColors(\n                    containerColor = MaterialTheme.colorScheme.primary\n                )\n            )\n        }\n    ) {\ padding ->\n        Column(\n            modifier = Modifier\n                .fillMaxSize()\n                .padding(padding)\n                .padding(16.dp),\n            horizontalAlignment = Alignment.CenterHorizontally\n        ) {\n            if (uiState.currentQuestion != null) {\n                Row(\n                    modifier = Modifier.fillMaxWidth(),\n                    horizontalArrangement = Arrangement.SpaceAround\n                ) {\n                    StatCounter(\"Question\", \"${uiState.questionCount + 1}\")\n                    StatCounter(\"Accuracy\", \"${if (uiState.questionCount > 0) (uiState.correctCount * 100 / uiState.questionCount) else 0}%\")\n                    StatCounter(\"Avg Time\", formatTime(uiState.avgTimeMs))\n                }\n\n                Spacer(modifier = Modifier.height(16.dp))\n\n                QuestionCard(\n                    questionText = uiState.currentQuestion!!.text,\n                    options = uiState.options,\n                    selectedIndex = uiState.selectedIndex,\n                    onOptionSelected = { viewModel.onOptionSelected(it) }                )\n\n                Spacer(modifier = Modifier.height(16.dp))\n\n                if (uiState.showResult) {\n                    val resultColor = if (uiState.isCorrect == true) Color(0xFF00C853) else Color(0xFFD50000)\n                    val resultText = if (uiState.isCorrect == true) \"✓ Correct\" else \"✗ Incorrect\"\n                    Card(colors = CardDefaults.cardColors(containerColor = resultColor)) {\n                        Text(\n                            text = resultText,\n                            modifier = Modifier.padding(horizontal = 16.dp, vertical = 4.dp),\n                            color = Color.White,\n                            fontWeight = FontWeight.Bold\n                        )\n                    }\n                    Spacer(modifier = Modifier.height(16.dp))\n\n                    FastLensCard(uiState.fastLens, uiState.showNoSafeShortcut)\n\n                    Spacer(modifier = Modifier.height(16.dp))\n\n                    Button(onClick = { viewModel.loadNextQuestion() }) {\n                        Text(\"Next Question\")\n                    }\n\n                } else {\n                    Button(\n                        onClick = { viewModel.submitAnswer() },\n                        enabled = uiState.selectedIndex != null && !uiState.isSubmitting\n                    ) {\n                        Text(\"Submit\")\n                    }\n                }\n\n            } else {\n                Text(\"Loading questions...\")\n            }\n        }\n    }\n}\n\n@Composable\nprivate fun StatCounter(label: String, value: String) {\n    Column(horizontalAlignment = Alignment.CenterHorizontally) {\n        Text(text = label, style = MaterialTheme.typography.labelMedium)\n        Text(text = value, style = MaterialTheme.typography.bodyLarge, fontWeight = FontWeight.Bold)\n    }\n}\n\nprivate fun formatTime(millis: Int): String {\n    val minutes = TimeUnit.MILLISECONDS.toMinutes(millis.toLong())\n    val seconds = TimeUnit.MILLISECONDS.toSeconds(millis.toLong()) - TimeUnit.MINUTES.toSeconds(minutes)\n    return String.format(\"%02d:%02d\", minutes, seconds)\n}\n